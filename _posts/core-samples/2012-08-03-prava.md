---
layout: post
title: Система контроля доступа.
category : lessons
tags : [chmod, rwx, chown]
---
{% include JB/setup %}



__________________________________

Суть политики Unix состоит в том, что пользователь сам определяет права доступа к своим файлам. Любой файл принадлежит только одному пользователю - *владельцу* этого файла. А первичная группа пользователя обычно определяет ту группу, которая будет установлена на файл.  
Для просмотра информации о файлах используют команду **ls -l**:
	$ ls -l
	$ -rw-rw-r-- 1 kanst9 kanst9   320 авг.   1 17:52 2012-08-03-prava.md

В данном примере, в первом поле содержится тип файла и права доступа к нему. Первый символ - дефис, значит, что перед нами обычный файл. Также существуют другие разновидности файлов:

+	Обычный файл **"-"**.
+	Каталог **"d"**.
+	Файл символьного устройства **"с"**.
+	Файл блочного устройства **"b"**.
+	Локальный сокет **"s"**.
+	Именованный канал **"p"**.
+	Символическая ссылка **"l"**.

Следующие девять символов определяют биты режима. Подробнее о них будут рассмотрены далее.  
Второе поле - количество жестких ссылок на файл. Далее идут владелец файла и группа. Потом указывается размер файла в байтах и дата последней модификации.

<h1>Биты режима.</h1>
Правя доступа к файлу хранятся в метаданных файла. Задавать права можно в символической и восьмеричной записи.  
Первые три символа (*rw-*) определяют права доступа владельца файла. Следующие три (*rw-*) - права группы. А последние (*r--*) - права доступа остальных пользователей.   
Бит **"r"** (4 в восьмеричной нотации) - бит чтения. Он позволяет открывать и читать файл.  
Бит **"w"** (2 в восьмеричной нотации) - бит записи. Он позволяет изменять файл. Правом удалять и переименовывать управляют биты, заданные для его родительского каталога.  
Бит **"x"** (1 в восьмеричной нотации) - бит выполнения. Он позволяет запускать файл. Для каталога он разрешает переходить в каталог или проходить через него для доступа к файлу.  
В данном примере, запись *rw-rw-r--*(664) означает, что пользователь и группа имеют права на чтение и запись, а остальные пользователи только на чтение. Восьмеричное значение получается сложением степеней двойки, соответствующих номеру бита в триаде. Например, 6 = 4 + 2, 7 = 4 + 2 + 1, 5 = 4 + 1.  
Помимо битов, устанавливающих разрешение на доступ к файлу, существуют специальные атрибуты, для которых предназначена еще одна триада битов. Это **setuid** (обозначается **s**), **setguid** (обозначается **s**) и **sticky bit** (обозначается **t**). Если первые два установлены для исполняемых файлов, они позволяют программам получают получать доступ к тем файлам, которые при прочих обстоятельствах недоступны для них. В настоящее время **sticky bit** игнорируется. В первых Unix-системах он запрещал выгрузку программ из памяти.


<h1>Изменение прав доступа с помощью команды chmod.</h1>
Правом изменять доступ к файлу имеют сам пользователь и суперпользователь.
Первый аргумент команды **chmod** - спецификация прав доступа. Он состоит из 3 цифр. Первая - бит пользователя, вторая - бит группы, третья - бит остальных пользователей. Если необходимо задать биты *setuid*, *setgid* или *sticky bit*, то следует указать четыре цифры. Первая будет определять специальные биты. Например:
	$ ls -l
	-rw-rw-r-- 1 kanst9 kanst9 0 авг.   2 15:15 primer 
	//Пользователь и группа - чтение и запись, остальные - чтение
	$ chmod 766
	-rwxrw-rw- 1 kanst9 kanst9 0 авг.   2 15:15 primer 
	//Пользователь - все действия, группа и остальные - чтение и запись
	$ chmod 6777
	-rwsrwsrwx 1 kanst9 kanst9 0 авг.   2 15:15 primer 
	//Установлены *setuid* и *setgid*

При использовании мнемонического синтаксиса используют символы:

+	**u** - пользователь
+	**g** - группа
+	**o** - другие
+	**a** - все
+	**+** - добавить
+	**-** - удалить
+	**=** - присвоить

Рассмотрим синтаксис на примерах:	
	$ ls -l
	-rw-rw-r-- 1 kanst9 kanst9 0 авг.   2 15:15 primer 
	$ chmog u-w,g-rw
	-r-----r-- 1 kanst9 kanst9 0 авг.   2 15:15 primer 
	$ chmod g=u
	-r--r--r-- 1 kanst9 kanst9 0 авг.   2 15:15 primer 

Для изменения владельца файла и группы используют команды **chown** и **chgrp**:  
**chown** *пользователь файл*  
**chgrp** *пользователь файл*  
**chown** *пользователь:группа файл*  
Флаг **-R** позволяет рекурсивно изменять владельцев каталога и подкаталогов. 

<h1>Стандартные права доступа с помощью команды umask.</h1>
При создании файла код доступа к нему устанавливается равным разнице между величиной, которую запрашивает создающая файл программа, и значением команды **umask**. Например команда **umask 013** даст файлу права *rwxrw-r--*.  
Стандартное значение **umask** можно установить в файле **.profile**, который предоставляется каждому пользователю системы.

<h1>Дополнительные флаги систем ext*.</h1>
Для просмотра и изменения дополнительных флагов существуют команды **lsattr** и **chattr**. Полезные флаги рассмотрены ниже:

+	**а** - Запись в файл только в режиме добавления (устанавливается суперпользователем).  
+	**i** - Сделать файл неудаляемым и неизменяемым (устанавливается суперпользователем).
Синтаксис команды **chattr** подобен синтаксису **chmod**(-+=). Остальные флаги можно посмотреть с помощью команды **man chattr**.   